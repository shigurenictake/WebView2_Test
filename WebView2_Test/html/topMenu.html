<!DOCTYPE html>

<style>
    .div-1 {
        background-color: #FBD603;
    }

    .div-2 {
        background-color: #ABBAEA;
    }
</style>

<html lang="ja">
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <script language="javascript" type="text/javascript">

        //C#からJavaScriptを呼び出す
        function jsFunc1(str1) {
            //タグを生成
            const tag = document.createElement("div");
            tag.innerText = str1;

            //未完了のリストに追加
            document.getElementById("CsToJs").appendChild(tag);

            return "success"
        }

        //JavaScriptからC#を呼び出す
        function ButtonClick_JsToCs() {
            //テキストボックスから値取得
            const sendtext = document.getElementById('sendtext');

            //C#の関数の実行
            chrome.webview.hostObjects.jsToCs.JsToCsMethod(sendtext.value);
        }
    </script>
</head>

<body>
    <p><b>トップメニュー(topMenu.html)</b></p>
    <div>
        <button id="btn-close" onclick="closeWindow()">htmlから閉じる</button>
        <div>window.closeする(ウィンドウを閉じる)</div>
        <script>
            function closeWindow() {
                window.close();
            }
        </script>
    </div>
    <br>
    <div>
        <button id="btn-html-new-win-a" onclick="openNewWindowHtml(id)">htmlからサブウィンドウ(A)</button>
        <button id="btn-html-new-win-b" onclick="openNewWindowHtml(id)">htmlからサブウィンドウ(B)</button>
        <div>window.openする(WebView2が自動で新しいウィンドウでページを開く。ウィンドウは独立する。)</div>
        <script>
            function openNewWindowHtml(id) {
                let path="";
                switch(id){
                    case "btn-html-new-win-a" :
                        path = "./subPatternA.html";
                        break;
                    case "btn-html-new-win-b" :
                        path = "./subpatternB.html";
                        break;
                    default : 
                }
                window.open(path, "_blank", "width=800,height=300");
            }
        </script>
    </div>
    <br>
    <div>
        <button id="btn-cs-new-win-a" onclick="openNewWindowByCs(id)">C#からサブウィンドウ(A)</button>
        <button id="btn-cs-new-win-b" onclick="openNewWindowByCs(id)">C#からサブウィンドウ(B)</button>
        <div>新しいフォーム(ウィンドウ)でページを開く。(メインフォームの子となり、メインフォームが閉じると閉じる)</div>
        <script>
            function openNewWindowByCs(id) {
                // 現在のURLの情報を取得する
                const currentUrl = new URL(window.location.href);
                // 相対パスをフルパスに変換する
                let relativePath="";
                switch(id){
                    case "btn-cs-new-win-a" :
                        relativePath = "./subPatternA.html";
                        break;
                    case "btn-cs-new-win-b" :
                        relativePath = "./subPatternB.html";
                        break;
                    default : 
                }
                const fullPath = new URL(relativePath, currentUrl).href;
                console.log(fullPath);
                //C#の関数の実行。htmlを新しいフォームで開く
                chrome.webview.hostObjects.jsToCs.WindowOpen(fullPath);
            }
        </script>
    </div>
    <br>
    <div>
        <button id="btn-self-win-a" onclick="windowOpenSelf(id)">htmlでURL切り替え(A)</button>
        <button id="btn-self-win-b" onclick="windowOpenSelf(id)">htmlでURL切り替え(B)</button>
        <div>htmlからwindow.openする</div>
        <script>
            function windowOpenSelf(id) {
                let path="";
                switch(id){
                    case "btn-self-win-a" :
                        path = "./patternA.html";
                        break;
                    case "btn-self-win-b" :
                        path = "./patternB.html";
                        break;
                    default : 
                }
                window.open(path, "_self");
            }
        </script>
    </div>

    </div>

    <div id="CsToJs" class="div-1">
        <p><b>◆C#から受け取った文字列＞</b></p>
    </div>
    <br>

    <div id="JsToCs" class="div-2">
        <p><b>◆JavaScriptからC#へ送信＞</b></p>
        <input type="text" id="sendtext">
        <input type="button" value='▼送信' onclick="ButtonClick_JsToCs();">
    </div>
    <br>

</body>
</html>